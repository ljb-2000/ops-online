<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="Will Zhao Modify">
        <link rel="shortcut icon" href="/static/images/favicon.png" type="/static/image/png">

        <title>OPS 管理系统-用户管理</title>

	<link href="/static/css/style.css" rel="stylesheet">
        <link href="/static/css/style.default.css" rel="stylesheet"> 
	<script src="/static/js/base.js"></script>

<script type="text/javascript">                    
    function search_ip(text, noselect, total){      
        $("#" + noselect).children().each(         	
            function(){
                $(this).remove();
            });    

        $("#" + total).children().each(function(){
            if($(this).text().search(text) != -1){  
                $("#" + noselect).append($(this).clone())               }
            })
    }
</script>

    </head>

    <body>
<div id="preloader">
    <div id="status"><i class="fa fa-spinner fa-spin"></i></div>
</div>
{% load mytags %}

        <section>

            <div class="leftpanel">

                <div class="logopanel">
                    <h1><span>[</span> Tcloud运维管理平台 <span>]</span></h1>
                </div>

                <div class="leftpanelinner">

                    <div class="visible-xs hidden-sm hidden-md hidden-lg">   
                        <div class="media userlogged">
                            <img alt="" src="/static/images/loggeduser.png" class="media-object">
                            <div class="media-body">
                                <h4>John Doe</h4>
                                <span>"Life is so..."</span>
                            </div>
                        </div>

                        <h5 class="sidebartitle actitle"></h5>
                        <ul class="nav nav-pills nav-stacked nav-bracket mb30">
                            <li><a href="/logout/"><i class="fa fa-sign-out"></i> <span>退出</span></a></li>
                        </ul>
                    </div>

                    <h5 class="sidebartitle">导航</h5>
                    <ul class="nav nav-pills nav-stacked nav-bracket">
                        <li><a href="/dashboard/"><i class="fa fa-home"></i> <span>Dashboard</span></a></li>
                        <li><a href="/tcloudvm/"><i class="fa fa-fax"></i> <span>虚机申请</span></a></li>
                        <li><a href="/codedeploy/"><i class="fa fa-file-code-o"></i> <span>代码部署</span></a></li>
                        <li>
   <a href="#asset" class="nav-header menu-first collapsed" data-toggle="collapse"><i class="fa fa-keyboard-o"></i> <span>资产管理</span></a>
                            <ul id="asset" class="nav nav-list collapse menu-second" style="height: 0px;">
                                <li class="group_list group_detail group_edit"><a href="/asset/group_list/">查看分组</a></li>
                                <li class="group_add"><a href="/asset/group_add/">添加分组</a></li>
                            </ul>
                        </li>
                        <li><a href="/saltstack/"><i class="fa fa-laptop"></i> <span>任务管理</span></a></li>
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-users"></i> <span>用户管理</span></a>
                            <ul class="dropdown-menu">
                                <li class="dept_list dept_edit"><a href="/ldapuser/dept_list/">查看部门</a></li>
                                <li class="dept_add"><a href="/ldapuser/dept_add/">添加部门</a></li>
                                <li class="group_list group_edit"><a href="/ldapuser/group_list/">查看小组</a></li>
                                <li class="group_add"><a href="/ldapuser/group_add/">添加小组</a></li>
                                <li class="user_list user_edit user_detail"><a href="/ldapuser/user_list/">查看用户</a></li>
                                <li class="user_add"><a href="/ldapuser/user_add/">添加用户</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-lock"></i> <span>权限管理</span></a>
                            <ul class="dropdown-menu">
                                <li class="dept_perm_list dept_perm_edit active"><a href="/ldapperm/dept_perm_list/">部门授权</a></li>
                                <li class="perm_list perm_edit perm_detail"><a href="/ldapperm/perm_list/">小组授权</a></li>
                                <li class="sudo_list sudo_edit sudo_add cmd_list cmd_edit cmd_add sudo_detail"><a href="/ldapperm/sudo_list/">sudo授权</a></li>
                            </ul>
                        </li>
                    </ul>

                </div>
            </div>

            <div class="mainpanel">

                <div class="headerbar">

                    <a class="menutoggle"><i class="fa fa-bars"></i></a>

                    <div class="header-right">
                        <ul class="headermenu">
                            <li>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                        <img src="/static/images/loggeduser.png" alt="" />
                                         {{user.username}}
                                    </button>
                                </div>
                            </li>
                            <li>
                                <button id="btn_sys_logout" class="btn btn-default tp-icon chat-icon" title="退出">
                                    <i class="glyphicon glyphicon-log-out"></i>
                                </button>
                            </li>
                        </ul>
                    </div>

                </div>

                <div class="pageheader">
                    <h2><i class="fa fa-keyboard-o"></i>分组添加<span></span></h2>
                    <div class="breadcrumb-wrapper">
                        <span class="label">You are here:</span>
                        <ol class="breadcrumb">
                            <li><a href="/dashboard/">OPS</a></li>
                            <li class="active">资产管理</li>
                        </ol>
                    </div>
                </div>

                <div class="contentpanel">

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-10">
            <div class="ibox float-e-margins">
                <div id="ibox-content" class="ibox-title">
                    <h5> 填写主机组基本信息 </h5>
                </div>

                 <select id="assets_total" name="assets" class="form-control m-b" size="12" multiple style="display: none">   
                    {% for asset in posts %}					
                        <option value="{{ asset.id }}">{{ asset.ip }}</option>   
                    {% endfor %}
                </select>

                <select id="asset_select_total" name="j_hosts" class="form-control m-b" size="12"  multiple style="display: none">
                    {% for asset in eposts %}
                    <option value="{{ asset.id }}">{{ asset.ip }}</option>
                    {% endfor %}
                </select>

                <div class="ibox-content">
                    {% if emg %}
                        <div class="alert alert-warning text-center">{{ emg }}</div>
                    {% endif %}
                    {% if smg %}
                        <div class="alert alert-success text-center">{{ smg }}</div>
                    {% endif %}
                    <form id="assetForm" method="post" class="form-horizontal">
                        <div class="form-group"><label class="col-sm-2 control-label"> 主机组名<span class="red-fonts">*</span></label>
                            <div class="col-sm-8" name="group_id" value="{{ post.id }}"><input type="text" value="{{ group.name }}" placeholder="" name="j_group" class="form-control"></div>
                        </div>
		
			 {% ifequal session_role_id 2 %}
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label for="j_dept" class="col-lg-2 control-label">所属部门<span class="red-fonts">*</span></label>
                                <div class="col-sm-8">
                                    <select id="j_dept" name="j_dept" class="form-control m-b" onchange="change_dept(this.value)">
                                        {% for d in edept %}
                                            <option value="{{ d.id }}">{{ d.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        {% endifequal %}

                        {% ifequal session_role_id 1 %}
                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label for="j_dept" class="col-lg-2 control-label">所属部门<span class="red-fonts" style="">*</span></label>
                                    <input type="text" name="j_dept" value="{{  edept.id }}" style="display: none">
                                    <div class="col-sm-8"><input type="text" value="{{  edept.name }}" class="form-control" readonly="readonly"></div>
                            </div>
                        {% endifequal %}

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label for="group_name" class="col-sm-2 control-label">过滤</label>
                            <div class="col-sm-4">
                                <input id="noselect" class="form-control" oninput="search_ip(this.value, 'assets', 'assets_total')">
                            </div>
                            <div class="col-sm-1">
                            </div>
                            <div id="select" class="col-sm-3">
                                <input  class="form-control" oninput="search_ip(this.value, 'asset_select', 'asset_select_total')">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="" class="col-sm-2 control-label">主机<span class="red-fonts">*</span></label>
                            <div class="col-sm-4">
                                <div>
                                    <select id="assets" name="assets" class="form-control m-b" size="12" multiple>
                                        {% for post in posts %}
                                        <option value="{{ post.id }}">{{ post.ip }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-1">
                                <div class="btn-group" style="margin-top: 60px;">
                                    <button type="button" class="btn btn-white" onclick="move('assets', 'asset_select', 'assets_total', 'asset_select_total'  )"><i class="fa fa-chevron-right"></i></button>
                                    <button type="button" class="btn btn-white" onclick="move_left('asset_select', 'assets', 'asset_select_total', 'assets_total')"><i class="fa fa-chevron-left"></i> </button>
                                </div>
                            </div>

                            <div class="col-sm-3">
                                <div>
                                    <select id="asset_select" name="j_hosts" class="form-control m-b" size="12"  multiple></select>
                                </div>
                            </div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group"><label class="col-sm-2 control-label"> 备注 </label>
                            <div class="col-sm-8"><input type="text" value="{{ j_comment }}" placeholder='' name="j_comment" class="form-control"></div>
                        </div>

                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-5">
                                <button class="btn btn-white" type="submit"> 重置 </button>
                                <button class="btn btn-primary" id="submit_button" type="submit" onclick="on_submit('groups_selected')  "> 提交 </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

        </section>

        <script src="/static/js/jquery-1.11.1.min.js"></script>
        <script src="/static/js/jquery-migrate-1.2.1.min.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script src="/static/js/modernizr.min.js"></script>
        <script src="/static/js/jquery.sparkline.min.js"></script>
        <script src="/static/js/toggles.min.js"></script>
        <script src="/static/js/retina.min.js"></script>
        <script src="/static/js/jquery.cookies.js"></script>
        <script src="/static/js/custom.js"></script>

    </body>

<script>
    $(document).ready(function(){                     
        $("#submit_button").click(function(){           
            $('#asset_select option').each(function(){   
                $(this).prop('selected', true)          
            })
        });

    });

    $('#assetForm').validator({       
    timely: 2,
    theme: "yellow_right_effect",      
    fields: {
        "j_group": {
            rule: "required",
            tip: "输入业务组名",
            ok: "",
            msg: {required: "业务组名必须填写!"},
            data: {'data-ok':"业务组名可以使用"}
        }
    },
    valid: function(form) {         
        form.submit();
        }
    });

    function on_submit(id){
        $('#'+id+' option').each(
            function(){
                $(this).prop('selected', true)
            })
        }


    function change_dept(dept_id){        
    $.get('/asset/dept_host_ajax/',       
            {'id': dept_id},               
            function(data){
                $('#assets').html(data)   
                $('#assets_total').html(data)    
            })
    }

</script>

</html>
